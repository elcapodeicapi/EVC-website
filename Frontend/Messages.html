<div id="navbar"></div>
<div id="messages"></div>
<link rel="stylesheet" href="/styles.css" />

<h2>Send Message</h2>
<form id="msgForm">
  <input type="number" id="toUserId" placeholder="Recipient User ID" required /><br />
  <textarea id="content" placeholder="Message"></textarea><br />
  <button type="submit">Send</button>
</form>

<script>
async function loadMessages() {
  const res = await fetch("http://localhost:4000/messages", {
    headers: { Authorization: "Bearer " + localStorage.getItem("token") }
  });
  const msgs = await res.json();
  const container = document.getElementById("messages");
  container.innerHTML = "<h2>Conversation</h2>";
  msgs.forEach((m) => {
    container.innerHTML += `<div><b>${m.fromUser?.name}</b> â†’ <i>${m.toUser?.name}</i>: ${m.content}</div>`;
  });
}

document.getElementById("msgForm").onsubmit = async (e) => {
  e.preventDefault();
  const toUserId = document.getElementById("toUserId").value;
  const content = document.getElementById("content").value;

  await fetch("http://localhost:4000/messages/send", {
    method: "POST",
    headers: {
      "Content-Type": "application/json",
      Authorization: "Bearer " + localStorage.getItem("token"),
    },
    body: JSON.stringify({ toUserId, content }),
  });

  loadMessages();
};

loadMessages();
</script>

<script>
  async function loadNavbar() {
    try {
      const res = await fetch("./Navbar.html");
      if (!res.ok) throw new Error("Failed to load navbar");
      document.getElementById("navbar").innerHTML = await res.text();
    } catch (err) {
      console.error(err);
    }
  }
  loadNavbar();

  function logout() {
    localStorage.removeItem("token");
    window.location.href = "Login.html";
  }
</script>
</body>
</html> 